#!/usr/bin/env node
'use strict';

const render = require('./render');
const routes = require('../site/routes');
const path = require('path');
const budo = require('budo');
const babelify = require('babelify');
const fs = require('fs');
const watchCss = require('./watch-css');

budo(null, {
  live: false,
  stream: process.stdout,
  browserify: {
    transform: babelify
  }
}).on('connect', () => {
  const now = new Date();
  console.log(`[${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}] Watching for changes to site directory ...`);
  render();
  watchCss();
}).on('exit', () => {
  // Clean generated files.
  routes().forEach((p) => {
    fs.unlink(path.join(__dirname, '../', p.dest, 'index.html'));
  });
});
